<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Conversation Practice - OpenAI Realtime</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-top: 0;
            border-bottom: 3px solid #007bff;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #555;
        }

        select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        button {
            flex: 1;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-start {
            background: #28a745;
            color: white;
        }

        .btn-start:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        .btn-start:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-end {
            background: #dc3545;
            color: white;
        }

        .btn-end:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }

        .btn-end:active {
            transform: translateY(0);
        }

        .btn-end:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            background: #ffc107;
            color: #333;
        }

        .btn-clear:hover {
            background: #e0a800;
        }

        .status {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 6px;
            font-weight: 500;
            text-align: center;
        }

        .status.idle {
            background: #e9ecef;
            color: #6c757d;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .presets {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }

        .presets h3 {
            margin-top: 0;
            color: #555;
            font-size: 1rem;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .preset-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #007bff;
            color: #007bff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: #007bff;
            color: white;
        }

        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéôÔ∏è Japanese Conversation Practice</h1>

        <div class="presets">
            <h3>Quick Presets:</h3>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPreset('restaurant')">üçú Restaurant</button>
                <button class="preset-btn" onclick="loadPreset('shopping')">üõçÔ∏è Shopping</button>
                <button class="preset-btn" onclick="loadPreset('directions')">üó∫Ô∏è Directions</button>
                <button class="preset-btn" onclick="loadPreset('casual')">üí¨ Casual Chat</button>
                <button class="preset-btn" onclick="loadPreset('business')">üíº Business</button>
            </div>
        </div>

        <form id="callForm">
            <div class="form-group">
                <label for="voice">Voice:</label>
                <select id="voice" name="voice">
                    <option value="alloy">Alloy (Neutral)</option>
                    <option value="echo">Echo (Male)</option>
                    <option value="shimmer">Shimmer (Female)</option>
                    <option value="ash">Ash (Male, British)</option>
                    <option value="ballad">Ballad (Male, Warm)</option>
                    <option value="coral">Coral (Female, Warm)</option>
                    <option value="sage">Sage (Female, British)</option>
                    <option value="verse">Verse (Male, Deep)</option>
                </select>
                <div class="help-text">Choose the voice for your AI conversation partner</div>
            </div>

            <div class="form-group">
                <label for="instructions">Instructions:</label>
                <textarea id="instructions" name="instructions" placeholder="Enter custom instructions for the AI tutor...">You are a helpful Japanese language tutor. Speak primarily in Japanese at a conversational pace. Help the user practice everyday dialogues and conversations. Be encouraging and patient.</textarea>
                <div class="help-text">Customize how the AI should behave during the conversation</div>
            </div>

            <div class="button-group">
                <button type="button" class="btn-start" id="startBtn" onclick="startConversation()">
                    üé§ Start Conversation
                </button>
                <button type="button" class="btn-end" id="endBtn" onclick="endConversation()" disabled>
                    ‚èπÔ∏è End Conversation
                </button>
            </div>

            <div class="button-group">
                <button type="button" class="btn-clear" onclick="clearApiKeyData()">
                    üîë Clear API Key
                </button>
            </div>
        </form>

        <div class="status idle" id="status">
            Ready to start. Click "Start Conversation" to begin.
        </div>
    </div>

    <script>
        // Wait for DOM and main.js to be ready
        document.addEventListener('DOMContentLoaded', function() {
            // Get functions from window (exported by main.js)
            const { makeCall, endCall, clearStoredApiKey } = window;

            let currentCall = null;

            const presets = {
            restaurant: {
                instructions: 'You are a Japanese restaurant server. Help the user practice ordering food, asking about menu items, and making requests in Japanese. Use polite Japanese (keigo) and be helpful. Occasionally suggest popular dishes.',
                voice: 'shimmer'
            },
            shopping: {
                instructions: 'You are a shop assistant in Japan. Help the user practice asking about products, prices, sizes, and making purchases in Japanese. Use polite Japanese and be helpful with product recommendations.',
                voice: 'coral'
            },
            directions: {
                instructions: 'You are a helpful Japanese person giving directions. Help the user practice asking for and understanding directions in Japanese. Use common location phrases and landmarks. Be patient and clear.',
                voice: 'alloy'
            },
            casual: {
                instructions: 'You are a friendly Japanese person having a casual conversation. Use casual Japanese (tame-guchi) and talk about everyday topics like hobbies, weather, food, and daily life. Be warm and conversational.',
                voice: 'echo'
            },
            business: {
                instructions: 'You are a Japanese business professional. Help the user practice formal business Japanese including greetings, meetings, and professional communication. Use very polite Japanese (keigo) and maintain a professional tone.',
                voice: 'sage'
            }
        };

        window.loadPreset = function(presetName) {
            const preset = presets[presetName];
            if (preset) {
                document.getElementById('instructions').value = preset.instructions;
                document.getElementById('voice').value = preset.voice;
                updateStatus(`Preset loaded: ${presetName}`, 'idle');
            }
        }

        window.startConversation = async function() {
            const voice = document.getElementById('voice').value;
            const instructions = document.getElementById('instructions').value;
            const startBtn = document.getElementById('startBtn');
            const endBtn = document.getElementById('endBtn');

            try {
                startBtn.disabled = true;
                updateStatus('Starting conversation...', 'idle');

                currentCall = await makeCall({
                    voice: voice,
                    instructions: instructions
                });

                startBtn.disabled = true;
                endBtn.disabled = false;
                updateStatus('üéôÔ∏è Conversation active - Speak now!', 'active');
            } catch (error) {
                console.error('Failed to start conversation:', error);
                updateStatus(`Error: ${error.message}`, 'error');
                startBtn.disabled = false;
                endBtn.disabled = true;
            }
        }

        window.endConversation = async function() {
            const startBtn = document.getElementById('startBtn');
            const endBtn = document.getElementById('endBtn');

            try {
                updateStatus('Ending conversation...', 'idle');
                await endCall();
                currentCall = null;

                startBtn.disabled = false;
                endBtn.disabled = true;
                updateStatus('Conversation ended. Ready to start again.', 'idle');
            } catch (error) {
                console.error('Failed to end conversation:', error);
                updateStatus(`Error ending call: ${error.message}`, 'error');
            }
        }

        window.clearApiKeyData = function() {
            if (confirm('Are you sure you want to clear the stored API key? You will need to enter it again next time.')) {
                clearStoredApiKey();
                updateStatus('API key cleared. You will be prompted for it on next call.', 'idle');
            }
        }

        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        }); // End DOMContentLoaded
    </script>
</body>
</html>
